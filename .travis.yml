language: java
sudo: true
jdk:
- openjdk11
  #script: "./mvnw clean package"
addons:
 ssh_known_hosts: 161.35.122.230

notifications:
 email:carlostapiam@gmail.com

before_install:
- openssl aes-256-cbc -K $encrypted_e79cab55eab4_key -iv $encrypted_e79cab55eab4_iv
  -in vicky.enc -out  ~/.ssh/vicky -d
- pwd
- ls -la
- chmod 644 ~/.ssh/known_hosts
- chmod 755 ~/.ssh
- chmod 600 ~/.ssh/vicky
- chmod a+x ./mvnw
- cd ~/.ssh
- pwd
- ls -la
- cd $TRAVIS_BUILD_DIR
- ls -la

install:
- "./mvnw clean package -DskipTests=true -Dmaven.javadoc.skip=true -B -V"

#env:
# global:
#  - REMOTEAPPDIR=/home/ctapia/backend/
#  - REMOTEUSER=ctapia
#  - REMOTEHOST=161.35.122.230
#  - PORT=8080

before_deploy:
 - openssl aes-256-cbc -K $encrypted_e79cab55eab4_key -iv $encrypted_e79cab55eab4_iv -in vicky.enc -out  ~/.ssh/vicky -d
 - eval "$(ssh-agent -s)"
 - chmod 600 ~/.ssh/vicky
 - ssh-add ~/.ssh/vicky

deploy:
 provider: script
 skip_cleanup: true
# github_token: $GITHUB_TOKEN
#script: bash scripts/deploy.sh
 script: rsync -rmaz --include="*/target" --include="*/scripts" --include="*.jar" --include="*.sh" --delete-after --quiet $TRAVIS_BUILD_DIR/ vtapia@161.35.122.230:/home/vtapia/backend
 on:
  branch: master
#after_success:
# - ssh -o StrictHostKeyChecking=no -i ~/.ssh/vicky ctapia@161.35.122.230 "~/backend/init.sh restart"
